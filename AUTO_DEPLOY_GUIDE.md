# GitHub Auto-Deployment Setup Guide

This setup enables automatic deployment when you push code to GitHub.

## ğŸ¯ How It Works

1. You push code to GitHub
2. GitHub sends webhook to your server
3. Webhook server receives the event
4. Auto-deploy script pulls latest code
5. Dependencies are updated
6. Application restarts automatically

## ğŸ“‹ Server Setup (One-time)

### 1. SSH into your server

```bash
ssh jecrc9597@jecrcfoundation.live
```

### 2. Navigate to app directory

```bash
cd /home/jecrcfoundation.live/jf-app-backend
```

### 3. Run setup script

```bash
chmod +x setup-webhook.sh
./setup-webhook.sh
```

**IMPORTANT:** The script will generate a webhook secret - **SAVE IT!**

### 4. Test webhook server

```bash
curl http://localhost:9000/health
```

Expected response:
```json
{"status":"OK","message":"GitHub Webhook Server is running"}
```

## ğŸ”— GitHub Webhook Configuration

### 1. Go to your repository settings

Visit: `https://github.com/amrahulsaini/jfapp/settings/hooks`

### 2. Click "Add webhook"

### 3. Configure webhook:

- **Payload URL:** `http://jecrcfoundation.live:9000/webhook`
  
- **Content type:** `application/json`
  
- **Secret:** Use the secret generated by setup script
  
- **Which events:**
  - â˜‘ Just the push event
  
- **Active:** â˜‘ Checked

### 4. Click "Add webhook"

### 5. Test the webhook

GitHub will send a test ping. Check if it shows a âœ… green checkmark.

## ğŸ§ª Testing Auto-Deployment

### 1. Make a change in your local code

```bash
cd c:\Users\ammra\Downloads\jf-app
# Make some changes to a file
git add .
git commit -m "Test auto-deployment"
git push origin master
```

### 2. Monitor deployment on server

```bash
# Watch deployment logs
tail -f /home/jecrcfoundation.live/jf-app-backend/deploy.log

# Watch webhook server logs
pm2 logs jf-webhook-server

# Check application status
pm2 status
```

### 3. Verify deployment

```bash
curl https://jecrcfoundation.live/api/health
```

## ğŸ“Š Monitoring & Management

### View webhook server logs
```bash
pm2 logs jf-webhook-server
```

### View deployment logs
```bash
tail -f /home/jecrcfoundation.live/jf-app-backend/deploy.log
```

### Restart webhook server
```bash
pm2 restart jf-webhook-server
```

### Stop webhook server
```bash
pm2 stop jf-webhook-server
```

### View all PM2 processes
```bash
pm2 status
```

## ğŸ” Security Notes

1. **Keep webhook secret secure** - Never commit it to Git
2. **Use HTTPS** - Consider setting up SSL for webhook endpoint
3. **Firewall** - Ensure port 9000 is accessible from GitHub IPs only (optional)
4. **Logs** - Regularly check and rotate logs

## ğŸ› Troubleshooting

### Webhook not triggering?

1. Check GitHub webhook delivery status:
   - Go to Settings â†’ Webhooks â†’ Recent Deliveries
   - Look for error messages

2. Check if webhook server is running:
   ```bash
   pm2 status jf-webhook-server
   curl http://localhost:9000/health
   ```

3. Check webhook server logs:
   ```bash
   pm2 logs jf-webhook-server
   ```

### Deployment failing?

1. Check deployment logs:
   ```bash
   tail -f /home/jecrcfoundation.live/jf-app-backend/deploy.log
   ```

2. Check if Git can pull:
   ```bash
   cd /home/jecrcfoundation.live/jf-app-backend
   git pull origin master
   ```

3. Check PM2 status:
   ```bash
   pm2 status jf-app-backend
   pm2 logs jf-app-backend
   ```

### Port 9000 not accessible?

1. Check firewall:
   ```bash
   sudo firewall-cmd --list-ports
   sudo firewall-cmd --add-port=9000/tcp --permanent
   sudo firewall-cmd --reload
   ```

2. Check if port is in use:
   ```bash
   netstat -tuln | grep 9000
   ```

## ğŸ“ File Structure

```
jf-app-backend/
â”œâ”€â”€ auto-deploy.sh              # Auto-deployment script
â”œâ”€â”€ webhook-server.js           # Webhook server
â”œâ”€â”€ webhook-ecosystem.config.js # PM2 config for webhook
â”œâ”€â”€ setup-webhook.sh            # One-time setup script
â”œâ”€â”€ deploy.log                  # Deployment logs
â””â”€â”€ webhook.log                 # Webhook server logs
```

## ğŸ‰ Success!

Once configured, every push to `master` branch will:
- âœ… Automatically pull latest code
- âœ… Install/update dependencies
- âœ… Restart the application
- âœ… Log all activities

No manual deployment needed! ğŸš€
